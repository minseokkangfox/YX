<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YX클랜 게시판</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');

    :root {
      --primary-color: #4a90e2;
      --secondary-color: #f8f9fa;
      --text-color: #333;
      --border-color: #e1e4e8;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: var(--secondary-color);
      margin: 0;
      padding: 0;
      color: var(--text-color);
      line-height: 1.6;
    }

    header {
      background-color: var(--primary-color);
      color: white;
      padding: 2rem 1rem;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    header h1 {
      margin: 0;
      font-weight: 700;
      font-size: 2rem;
    }

    .youtube-button {
      background-color: #ff0000;
      color: white;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .youtube-button:hover {
      background-color: #cc0000;
    }

    .discord-button {
      background-color: #7289da;
      color: white;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .discord-button:hover {
      background-color: #5b73c7;
    }

    .social-buttons {
      text-align: center;
      padding: 2rem;
      background-color: white;
      margin-top: 2rem;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: center;
      gap: 1rem;
    }

    main {
      max-width: 800px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      border-radius: 12px;
    }

    input, textarea {
      width: 100%;
      padding: 0.8rem;
      margin: 0.5rem 0;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    }

    button {
      padding: 0.8rem 1.5rem;
      margin: 0.5rem 0;
      border: none;
      border-radius: 6px;
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #357abd;
    }

    #postList div {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1.2rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    #postList div:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    #postList div strong {
      font-size: 1.1rem;
      color: var(--text-color);
      display: block;
      margin-bottom: 0.5rem;
    }

    #postList div small {
      color: #666;
    }

    #postDetail {
      display: none;
      margin-top: 2rem;
      border-top: 2px solid var(--border-color);
      padding-top: 1.5rem;
    }

    .comment {
      background: var(--secondary-color);
      margin: 0.8rem 0;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }

    #userArea {
      background-color: var(--secondary-color);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
    }

    #userInfo {
      margin: 0;
      font-weight: 500;
      color: var(--primary-color);
    }

    h2, h3, h4 {
      color: var(--text-color);
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    #authForm {
      background-color: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    #postForm {
      background-color: white;
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      margin-bottom: 2rem;
    }

    .search-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 1rem;
    }
    
    .search-bar input {
      flex: 1;
    }
    
    .post-meta {
      color: #666;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 1rem;
    }
    
    .like-button {
      display: flex;
      align-items: center;
      gap: 5px;
      background-color: #f8f9fa;
      color: #333;
    }
    
    .like-button.active {
      background-color: #ff4757;
      color: white;
    }
    
    .sort-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 1rem;
    }
    
    .delete-button {
      background-color: #ff4757;
    }
    
    .delete-button:hover {
      background-color: #ff3747;
    }
    
    .edit-button {
      background-color: #5f27cd;
    }
    
    .edit-button:hover {
      background-color: #4f17bd;
    }
  </style>
</head>
<body>
  <header>
    <h1>YX클랜 커뮤니티</h1>
  </header>
  <main>
    <div id="authForm">
        <input type="text" id="username" placeholder="이름 (닉네임) 입력"><br>
        <input type="email" id="email" placeholder="이메일 입력"><br>
        <input type="password" id="password" placeholder="비밀번호 입력"><br>
        <button onclick="register()">회원가입</button>
        <button onclick="login()">로그인</button>
      </div>

    <div id="userArea" style="display:none;">
      <p id="userInfo"></p>
      <button onclick="logout()">로그아웃</button>
    </div>

    <div id="postForm" style="display:none;">
      <h2>게시글 작성</h2>
      <input type="text" id="title" placeholder="제목"><br>
      <textarea id="content" rows="4" placeholder="내용을 입력하세요"></textarea><br>
      <button onclick="submitPost()">작성 완료</button>
    </div>

    <div id="postList">
      <h2>📄 게시글 목록</h2>
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="게시글 검색...">
        <button onclick="searchPosts()">검색</button>
      </div>
      <div class="sort-buttons">
        <button onclick="sortPosts('latest')">최신순</button>
        <button onclick="sortPosts('likes')">인기순</button>
      </div>
    </div>

    <div id="postDetail">
      <h3 id="detailTitle"></h3>
      <p id="detailAuthor"></p>
      <p id="detailContent"></p>
      <p class="post-meta" id="detailDate"></p>
      <div class="action-buttons">
        <button class="like-button" onclick="toggleLike()">
          ❤️ <span id="likeCount">0</span>
        </button>
        <button class="edit-button" onclick="editPost()" style="display: none;">수정</button>
        <button class="delete-button" onclick="deletePost()" style="display: none;">삭제</button>
      </div>
      <h4>💬 댓글</h4>
      <div id="commentList"></div>
      <textarea id="newComment" placeholder="댓글 작성..." rows="2"></textarea><br>
      <button onclick="submitComment()">댓글 달기</button>
    </div>
  </main>

  <div class="social-buttons">
    <button class="youtube-button" onclick="window.open('https://www.youtube.com/@티미월드', '_blank')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
      </svg>
      유튜브 채널
    </button>
    <button class="discord-button" onclick="window.open('https://discord.gg/uZmsRDyYkQ', '_blank')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.118.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.956 2.419-2.157 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.946 2.419-2.157 2.419z"/>
      </svg>
      디스코드 참여하기
    </button>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCVciBor_0vj8NyuKJ080-HyfE-VRjam70",
      authDomain: "yxclan-90b06.firebaseapp.com",
      projectId: "yxclan-90b06",
      storageBucket: "yxclan-90b06.appspot.com",
      messagingSenderId: "291460759619",
      appId: "1:291460759619:web:18bcecb89c3570e7d7d4f6",
      measurementId: "G-QZ9JQRZ3CH"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentPostId = null;
    let currentPost = null;

    auth.onAuthStateChanged(user => {
  if (user) {
    db.collection("users").doc(user.uid).get().then(doc => {
      const name = doc.exists ? doc.data().name : user.email;
      document.getElementById("authForm").style.display = "none";
      document.getElementById("userArea").style.display = "block";
      document.getElementById("postForm").style.display = "block";
      document.getElementById("userInfo").innerText = `${name}님 환영합니다!`;
    });
  } else {
    document.getElementById("authForm").style.display = "block";
    document.getElementById("userArea").style.display = "none";
    document.getElementById("postForm").style.display = "none";
  }
  loadPosts();
});


    function register() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const name = document.getElementById("username").value.trim();
      if (!email || !password || !name) return alert("이름, 이메일, 비밀번호를 모두 입력해주세요");
      
      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          return db.collection("users").doc(userCredential.user.uid).set({
            name: name,
            email: email
          });
        })
        .then(() => alert("회원가입 완료"))
        .catch(error => alert("오류: " + error.message));
    }

    function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!email || !password) return alert("이메일과 비밀번호 입력 필수");
      auth.signInWithEmailAndPassword(email, password)
        .catch(error => alert("로그인 실패: " + error.message));
    }

    function logout() {
      auth.signOut();
    }

    function submitPost() {
      const title = document.getElementById("title").value.trim();
      const content = document.getElementById("content").value.trim();
      const user = auth.currentUser;
      if (!title || !content) return alert("내용을 입력하세요.");
      
      db.collection("users").doc(user.uid).get().then(doc => {
        const authorName = doc.exists ? doc.data().name : user.email;
        db.collection("posts").add({
          title,
          content,
          author: authorName,
          authorId: user.uid,
          createdAt: new Date(),
          likeCount: 0,
          likes: {}
        }).then(() => {
          document.getElementById("title").value = "";
          document.getElementById("content").value = "";
          loadPosts();
        });
      });
    }

    function loadPosts() {
      const postList = document.getElementById("postList");
      postList.innerHTML = "<h2>📄 게시글 목록</h2>";
      sortPosts('latest');
    }

    function showPostDetail(postId, data) {
      currentPostId = postId;
      currentPost = data;
      document.getElementById("detailTitle").innerText = data.title;
      document.getElementById("detailAuthor").innerText = `작성자: ${data.author}`;
      document.getElementById("detailContent").innerText = data.content;
      document.getElementById("detailDate").innerText = 
        `작성일: ${data.createdAt ? data.createdAt.toDate().toLocaleString() : '날짜 없음'}`;
      document.getElementById("likeCount").innerText = data.likeCount || 0;
      document.getElementById("postDetail").style.display = "block";
      
      // 수정/삭제 버튼 표시 여부
      const user = auth.currentUser;
      const editButton = document.querySelector(".edit-button");
      const deleteButton = document.querySelector(".delete-button");
      if (user && data.authorId === user.uid) {
        editButton.style.display = "block";
        deleteButton.style.display = "block";
      } else {
        editButton.style.display = "none";
        deleteButton.style.display = "none";
      }
      
      // 좋아요 버튼 상태 업데이트
      const likeButton = document.querySelector(".like-button");
      if (user && data.likes && data.likes[user.uid]) {
        likeButton.classList.add("active");
      } else {
        likeButton.classList.remove("active");
      }
      
      loadComments(postId);
    }

    function loadComments(postId) {
      const commentList = document.getElementById("commentList");
      commentList.innerHTML = "";
      db.collection("posts").doc(postId).collection("comments")
        .orderBy("createdAt").get().then(snapshot => {
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.className = "comment";
            div.innerText = `${data.author}: ${data.text}`;
            commentList.appendChild(div);
          });
        });
    }

    function submitComment() {
      const text = document.getElementById("newComment").value.trim();
      const user = auth.currentUser;
      if (!text) return alert("댓글을 입력하세요.");
      
      db.collection("users").doc(user.uid).get().then(doc => {
        const authorName = doc.exists ? doc.data().name : user.email;
        db.collection("posts").doc(currentPostId).collection("comments").add({
          text,
          author: authorName,
          authorId: user.uid,
          createdAt: new Date()
        }).then(() => {
          document.getElementById("newComment").value = "";
          loadComments(currentPostId);
        });
      });
    }

    function searchPosts() {
      const searchTerm = document.getElementById("searchInput").value.toLowerCase();
      const postList = document.getElementById("postList");
      postList.innerHTML = "<h2>📄 게시글 목록</h2>" +
        '<div class="search-bar">' +
        '<input type="text" id="searchInput" placeholder="게시글 검색...">' +
        '<button onclick="searchPosts()">검색</button>' +
        '</div>' +
        '<div class="sort-buttons">' +
        '<button onclick="sortPosts(\'latest\')">최신순</button>' +
        '<button onclick="sortPosts(\'likes\')">인기순</button>' +
        '</div>';
    
      db.collection("posts").get().then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.title.toLowerCase().includes(searchTerm) || 
              data.content.toLowerCase().includes(searchTerm)) {
            const div = createPostElement(doc.id, data);
            postList.appendChild(div);
          }
        });
      });
    }
    
    function sortPosts(criteria) {
      const postList = document.getElementById("postList");
      postList.innerHTML = "<h2>📄 게시글 목록</h2>" +
        '<div class="search-bar">' +
        '<input type="text" id="searchInput" placeholder="게시글 검색...">' +
        '<button onclick="searchPosts()">검색</button>' +
        '</div>' +
        '<div class="sort-buttons">' +
        '<button onclick="sortPosts(\'latest\')">최신순</button>' +
        '<button onclick="sortPosts(\'likes\')">인기순</button>' +
        '</div>';
    
      let query = db.collection("posts");
      if (criteria === 'latest') {
        query = query.orderBy("createdAt", "desc");
      } else if (criteria === 'likes') {
        query = query.orderBy("likeCount", "desc");
      }
    
      query.get().then(snapshot => {
        snapshot.forEach(doc => {
          const div = createPostElement(doc.id, doc.data());
          postList.appendChild(div);
        });
      });
    }
    
    function createPostElement(id, data) {
      const div = document.createElement("div");
      const date = data.createdAt ? data.createdAt.toDate().toLocaleString() : '날짜 없음';
      const likes = data.likeCount || 0;
      div.innerHTML = `
        <strong>${data.title}</strong>
        <br>
        <small>${data.author}</small>
        <div class="post-meta">
          <span>❤️ ${likes}</span> • 
          <span>${date}</span>
        </div>
      `;
      div.onclick = () => showPostDetail(id, data);
      return div;
    }

    function toggleLike() {
      const user = auth.currentUser;
      if (!user) return alert("로그인이 필요합니다.");
      
      const postRef = db.collection("posts").doc(currentPostId);
      
      db.runTransaction(transaction => {
        return transaction.get(postRef).then(doc => {
          if (!doc.exists) return;
          
          const data = doc.data();
          const likes = data.likes || {};
          const likeCount = data.likeCount || 0;
          
          if (likes[user.uid]) {
            delete likes[user.uid];
            transaction.update(postRef, {
              likes,
              likeCount: likeCount - 1
            });
          } else {
            likes[user.uid] = true;
            transaction.update(postRef, {
              likes,
              likeCount: likeCount + 1
            });
          }
        });
      }).then(() => {
        loadPosts();
        postRef.get().then(doc => {
          if (doc.exists) {
            showPostDetail(currentPostId, doc.data());
          }
        });
      });
    }
    
    function editPost() {
      const user = auth.currentUser;
      if (!user || currentPost.authorId !== user.uid) return;
      
      const newTitle = prompt("수정할 제목:", currentPost.title);
      const newContent = prompt("수정할 내용:", currentPost.content);
      
      if (newTitle && newContent) {
        db.collection("posts").doc(currentPostId).update({
          title: newTitle,
          content: newContent,
          updatedAt: new Date()
        }).then(() => {
          alert("게시글이 수정되었습니다.");
          loadPosts();
          db.collection("posts").doc(currentPostId).get().then(doc => {
            if (doc.exists) {
              showPostDetail(currentPostId, doc.data());
            }
          });
        });
      }
    }
    
    function deletePost() {
      const user = auth.currentUser;
      if (!user || currentPost.authorId !== user.uid) return;
      
      if (confirm("정말로 이 게시글을 삭제하시겠습니까?")) {
        db.collection("posts").doc(currentPostId).delete().then(() => {
          alert("게시글이 삭제되었습니다.");
          document.getElementById("postDetail").style.display = "none";
          loadPosts();
        });
      }
    }
  </script>
</body>
</html>
